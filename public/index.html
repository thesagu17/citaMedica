<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Gestión Médica - Pacientes & Citas</title>
  <style>
    body { font-family: Arial; margin: 0; background: #f7f9fb; }

    /* NAVBAR */
    nav {
      background: #007bff;
      padding: 14px;
      display: flex;
      gap: 15px;
    }
    nav a {
      color: white;
      text-decoration: none;
      font-weight: bold;
      background: rgba(255,255,255,0.2);
      padding: 8px 15px;
      border-radius: 5px;
    }
    nav a:hover { background: rgba(0,0,0,0.2); }

    main {
      padding: 40px;
      max-width: 1200px;
      margin: auto;
    }

    h1, h2 { color: #333; margin-bottom: 10px; }

    /* Formulario */
    form {
      background: white;
      padding: 20px;
      border-radius: 10px;
      max-width: 600px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }

    label { display: block; margin-top: 10px; font-weight: bold; }
    input, select, textarea {
      width: 100%; padding: 8px; margin-top: 5px;
      border: 1px solid #ccc; border-radius: 5px;
    }

    button {
      background: #007bff; color: white; border: none;
      padding: 10px 15px; border-radius: 5px; margin-top: 15px;
      cursor: pointer;
    }
    button:hover { background: #0056b3; }

    /* Tablas */
    table { width: 100%; border-collapse: collapse; margin-top: 15px; background: white; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #f0f0f0; }

    .actions { margin-bottom: 10px; }

    .btn-edit {
      background: #2c84f7;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
    }
    .btn-edit:hover {
      background: #337fe4;
    }
  </style>
</head>
<body>

<!-- BARRA -->
<nav>
  <a href="/">Inicio</a>
  <a href="/cita/nueva">Nueva Cita</a>
  <a href="lista_citas.html">Reporte de Citas</a>
</nav>

<main>

  <!-- FORMULARIO PACIENTE -->
  <h1>Registrar Paciente</h1>
  <form id="formPaciente">
    <label>Número de Documento:</label>
    <input type="text" id="nro_documento" required />

    <label>Nombre:</label>
    <input type="text" id="nombre" required />

    <label>Apellido:</label>
    <input type="text" id="apellido" required />

    <label>Fecha de Nacimiento:</label>
    <input type="date" id="fecha_nacimiento" />

    <label>Sexo:</label>
    <select id="sexo">
      <option value="">Seleccione...</option>
      <option value="M">Masculino</option>
      <option value="F">Femenino</option>
    </select>

    <label>Teléfono:</label>
    <input type="text" id="telefono" />

    <label>Email:</label>
    <input type="email" id="email" />

    <label>Dirección:</label>
    <textarea id="direccion" rows="3"></textarea>

    <button type="submit">Registrar Paciente</button>
  </form>

  <!-- LISTA PACIENTES -->
  <h2>Lista de Pacientes</h2>
  <div class="actions">
    <button onclick="cargarPacientes()">Actualizar Lista</button>
  </div>

  <table id="tablaPacientes">
    <thead>
      <tr>
        <th>ID</th>
        <th>Documento</th>
        <th>Nombre</th>
        <th>Apellido</th>
        <th>Sexo</th>
        <th>Teléfono</th>
        <th>Email</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

</main>

<!-- JS -->
<script>
  const API_PACIENTES = 'http://localhost:3000/pacientes';
  const API_CITAS = 'http://localhost:3000/citas';

  // Registrar paciente
  document.getElementById('formPaciente').addEventListener('submit', async (e) => {
    e.preventDefault();
    const data = {
      nro_documento: nro_documento.value,
      nombre: nombre.value,
      apellido: apellido.value,
      fecha_nacimiento: fecha_nacimiento.value,
      sexo: sexo.value,
      telefono: telefono.value,
      email: email.value,
      direccion: direccion.value,
    };

    const res = await fetch(API_PACIENTES, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });

    if (res.ok) {
      alert(' Paciente registrado');
      formPaciente.reset();
      cargarPacientes();
    } else {
      alert(` ${await res.text()}`);
    }
  });

  // Cargar pacientes
  async function cargarPacientes() {
    const res = await fetch(API_PACIENTES);
    const data = await res.json();
    const tbody = document.querySelector('#tablaPacientes tbody');
    tbody.innerHTML = data.map(p => `
      <tr>
        <td>${p.paciente_id}</td>
        <td>${p.nro_documento}</td>
        <td>${p.nombre}</td>
        <td>${p.apellido}</td>
        <td>${p.sexo || ''}</td>
        <td>${p.telefono || ''}</td>
        <td>${p.email || ''}</td>
        <td>
          <button class="btn-edit" onclick="editarPaciente(${p.paciente_id})">Editar</button>
        </td>
      </tr>
    `).join('');
  }

  // Redirigir a la página de edición
  function editarPaciente(id) {
    window.location.href = `/pacientes/editar/${id}`;
  }

  // Al cargar página
  cargarPacientes();
</script>

</body>
</html>
